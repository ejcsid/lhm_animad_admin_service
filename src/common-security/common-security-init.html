<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../../bower_components/iron-meta/iron-meta.html">
<link rel="import" href="../animad-icons.html">

<link rel="import" href="../behaviors/animad-form-behavior.html">
<link rel="import" href="../behaviors/mixin.html">

<dom-module id="common-security-init">
    <script>
        /**
         * # Element zum initialen Abrufen der Rechte des aktuellen Users.
         * Muss in die index.html eingebunden werden, damit es von den anderen 
         * Security-Tags aus auffindbar ist.
         * 
         * @customElement
         * @polymer
         *
         */
        class CommonSecurityInit extends mix(Polymer.Element).with(AnimadFormBehavior) {

            static get is() {
                return 'common-security-init';
            }

            // properties
            static get properties() {
                return {
                    /**
                     * Url um die Permissions abzurufen.
                     */
                    permissionsUrl: {
                        type: String,
                        value: "http://localhost:8870/getPermissionsDummy"
                    },
                    _permissions: {
                        type: Object,
                        value: [],
                        notify: true
                    },
                    //inherited from AnimadFormBehaviour (kann man auch ohne das einen 
                    //observer registrieren?
                    data: {
                        type: Object,
                        notify: true,
                        observer: '_dataUpdated'
                    },
                }
            }

            constructor() {
                super();
            }

            connectedCallback() {
                super.connectedCallback();

            }

            // methods

            checkPermissions(permissionToCheck) {
                if (this._permissions.filter(e => e === permissionToCheck).length > 0) {
                    console.log('checkPermissions: Permission ' + permissionToCheck + ' found in list');
                    return true;
                }
                console.log('checkPermissions: Permission ' + permissionToCheck + ' NOT found in list. Found: ' + this._permissions);
                return false;
            }

            getPermissions() {
                return this._permissions;
            }


            _changed() {
                console.log('changed!');
            }
            
            _dataUpdated() {
                console.log('data updated: ' + this.data._embedded.permissions);
                this._permissions = this.data._embedded.permissions;
                window.dispatchEvent(new CustomEvent('permissionsReceived', {detail: {kicked: true}}));
            }

        }



        customElements.define(CommonSecurityInit.is, CommonSecurityInit);
    </script>
</dom-module>
